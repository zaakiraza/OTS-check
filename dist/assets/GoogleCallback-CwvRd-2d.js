import{aG as y,e as A,q as N,r as i,w as R,v as T,j as e,B as p,V as x,T as l,ae as b}from"./index-BK1bU2bz.js";import{O as o}from"./oauthConfig-CU22yB20.js";const U=()=>{const[a]=y(),t=A(),n=N(),[h,I]=i.useState(!0),[u,c]=i.useState(null),[S,E]=i.useState(!1),{setLoginUserInfo:g,setUserLoginToken:d}=R(),{getEnrollmentsByStudentId:C}=T();return i.useEffect(()=>{if(S)return;(async()=>{E(!0);try{const s=a.get("token"),m=a.get("user");if(a.get("error")){c(o.AUTHENTICATION_FAILED),n({title:"Login Failed",description:o.AUTHENTICATION_FAILED,status:"error",duration:5e3,isClosable:!0}),setTimeout(()=>t("/login"),3e3);return}if(!s||!m){c(o.INVALID_CALLBACK),n({title:"Login Error",description:o.INVALID_CALLBACK,status:"error",duration:5e3,isClosable:!0}),setTimeout(()=>t("/login"),3e3);return}const r=JSON.parse(decodeURIComponent(m));g(r),d(s),localStorage.setItem("userToken",s),localStorage.setItem("userInfo",JSON.stringify(r)),localStorage.setItem("userId",r.id),n({title:"Login Successful",description:`Welcome, ${r.firstName||r.username}!`,status:"success",duration:5e3,isClosable:!0});try{(await C(r.id,s)).status===!1?t("/explore/category"):t("/dashboard")}catch(f){console.error("Error fetching enrollments:",f),t("/dashboard")}}catch(s){console.error("Error processing Google callback:",s),c(o.UNKNOWN_ERROR),n({title:"Authentication Error",description:o.UNKNOWN_ERROR,status:"error",duration:5e3,isClosable:!0}),setTimeout(()=>t("/login"),3e3)}finally{I(!1)}})()},[a,t,n,g,d]),u?e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bg:"gray.50",children:e.jsxs(x,{spacing:4,children:[e.jsx(l,{fontSize:"lg",color:"red.500",textAlign:"center",children:u}),e.jsx(l,{fontSize:"sm",color:"gray.600",children:"Redirecting to login page..."})]})}):e.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bg:"gray.50",children:e.jsxs(x,{spacing:4,children:[e.jsx(b,{size:"xl",color:"orange.400",thickness:"4px"}),e.jsx(l,{fontSize:"lg",textAlign:"center",children:h?"Completing your sign-in...":"Redirecting..."}),e.jsx(l,{fontSize:"sm",color:"gray.600",children:"Please wait while we set up your account."})]})})};export{U as default};
