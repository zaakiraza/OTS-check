import{r as o,q as B,w as V,x as D,e as q,j as e,B as x,y as H,z as M,C as U,D as _,g as O,H as L,T as c,V as N}from"./index-BK1bU2bz.js";import{B as T}from"./BOX-CozHWWeK.js";import{H as $}from"./h-stack-Bagx0LFm.js";import{I as G}from"./input-lBRgIHT7.js";import{F as Y}from"./form-control-Bp5uebuv.js";import"./use-form-control-Bfrk_d33.js";function te(){const[m,y]=o.useState(["","","",""]),g=o.useRef([]),[n,f]=o.useState(60),[u,F]=o.useState(!1),[A,h]=o.useState(!1),r=B(),{signUpOtp:P,resendOtp:R}=V(),{startOtpSession:S,handleOtpAttempt:v,updateActivity:C,isOtpActive:j,isBlocked:a,remainingAttempts:E,timeRemaining:w,isSessionExpired:p}=D(),l=q(),d=localStorage.getItem("registeredUserEmail");o.useEffect(()=>{d&&!j&&S()},[d,j,S]),o.useEffect(()=>{if(!d){l("/signup");return}if(p){l("/signup");return}},[d,p,l]);const I=async s=>{if(!s){r({title:"Missing Email",description:"Email is required to resend OTP.",status:"warning",duration:4e3,isClosable:!0,position:"top"});return}F(!0);const t=await R(s);r({title:t.success?"Success":"Failed",description:t.message,status:t.success?"success":"error",duration:4e3,isClosable:!0,position:"top"}),t.success&&f(60),F(!1)};o.useEffect(()=>{const s=setInterval(()=>{f(t=>t<=1?(clearInterval(s),0):t-1)},1e3);return()=>clearInterval(s)},[]);const W=s=>{const t=Math.floor(s/60).toString().padStart(2,"0"),i=(s%60).toString().padStart(2,"0");return`${t}:${i}`},k=(s,t)=>{var i;if(!(n===0||a||p)&&(C(),/^\d*$/.test(s))){const b=[...m];b[t]=s,y(b),s&&t<3&&((i=g.current[t+1])==null||i.focus())}},z=async s=>{if(s.preventDefault(),a){r({title:"Account Blocked",description:"Too many failed attempts. Please start over.",status:"error",duration:4e3,isClosable:!0,position:"top"});return}if(p){r({title:"Session Expired",description:"Your verification session has expired. Please start over.",status:"warning",duration:4e3,isClosable:!0,position:"top"}),l("/signup");return}if(n===0){r({title:"OTP Expired",description:"Please request a new OTP.",status:"warning",duration:4e3,isClosable:!0,position:"top"});return}const t=m.join("");if(t.length<4){r({title:"Incomplete OTP",description:"Please enter all 4 digits.",status:"warning",duration:4e3,isClosable:!0,position:"top"});return}h(!0);const i=await P(t);h(!1),v(i.success)?(r({title:"OTP Verified",description:"You are successfully registered!",status:"success",duration:4e3,isClosable:!0,position:"top"}),l("/login")):a||r({title:"Verification Failed",description:i.message||"Invalid OTP. Please try again.",status:"error",duration:4e3,isClosable:!0,position:"top"})};return a?e.jsx(T,{children:e.jsxs(x,{p:{base:"24px",sm:"32px",md:"36px"},mt:{base:"136px",sm:"156px",md:"194px"},borderRadius:"24px",boxShadow:"2xl",maxW:{base:"75%",md:"85%",lg:"100%"},width:"350px",bgGradient:"linear(to-br, #FFFFFF00 0%, #FFFFFF20 100%)",border:"1px solid #FFFFFF35",backdropFilter:"blur(24px)",children:[e.jsxs(H,{status:"error",borderRadius:"md",mb:4,children:[e.jsx(M,{}),e.jsxs(x,{children:[e.jsx(U,{children:"Account Blocked!"}),e.jsx(_,{children:"Too many failed attempts. Please start the registration process again."})]})]}),e.jsx(O,{onClick:()=>l("/signup"),bg:"#F49040",color:"white",width:"full",borderRadius:"30px",_hover:{bg:"#e67e22"},children:"Start Over"})]})}):e.jsx(T,{children:e.jsxs(x,{p:{base:"24px",sm:"32px",md:"36px"},mt:{base:"136px",sm:"156px",md:"194px"},borderRadius:"24px",boxShadow:"2xl",maxW:{base:"75%",md:"85%",lg:"100%"},width:"350px",bgGradient:"linear(to-br, #FFFFFF00 0%, #FFFFFF20 100%)",border:"1px solid #FFFFFF35",backdropFilter:"blur(24px)",children:[e.jsx(L,{w:"350px",maxW:"100%",color:"#F49040",textAlign:"center",mt:{base:"2px",sm:"8px",md:"12px"},mb:{base:"8px",sm:"14px",md:"18px"},fontSize:{base:"24px",sm:"32px",md:"32px"},fontWeight:"bold",children:"Verification OTP"}),e.jsxs(c,{fontWeight:"light",color:"#FFFFFF",w:"350px",maxW:"100%",textAlign:"center",mb:{base:"16px",sm:"24px",md:"36px"},fontSize:{base:"14px",sm:"16px",md:"18px"},children:["We have sent you a verification code on"," ",e.jsx(c,{as:"span",fontWeight:"semibold",color:"#F49040",children:d})]}),e.jsxs(x,{mb:4,p:3,bg:"rgba(244, 144, 64, 0.1)",borderRadius:"md",border:"1px solid #F49040",children:[e.jsx(c,{fontSize:"sm",color:"#F49040",textAlign:"center",fontWeight:"semibold",children:"Security Notice"}),e.jsxs(c,{fontSize:"xs",color:"#FFFFFF",textAlign:"center",mt:1,children:["Session expires in ",Math.floor(w/6e4),":",Math.floor(w%6e4/1e3).toString().padStart(2,"0")]}),e.jsxs(c,{fontSize:"xs",color:"#FFFFFF",textAlign:"center",mt:1,children:[E," attempts remaining"]})]}),e.jsxs("form",{onSubmit:z,children:[e.jsx($,{spacing:4,justify:"center",mb:{base:"16px",sm:"18px",md:"24px"},children:m.map((s,t)=>e.jsx(G,{placeholder:"-",type:"text",maxLength:1,value:s,onChange:i=>k(i.target.value,t),ref:i=>g.current[t]=i,textAlign:"center",fontSize:{base:"14px",sm:"16px",md:"18px"},borderRadius:"12px",border:"1px solid #CED4D3",_focus:{outline:"none",boxShadow:"0px 0px 12px #F49040",border:"1px solid #F49040",bg:"white"},width:{base:"40px",sm:"48px",md:"56px"},height:{base:"40px",sm:"48px",md:"56px"},bg:"white",isDisabled:n===0||a||p},t))}),e.jsx(x,{fontSize:{base:"12px",sm:"14px",md:"16px"},fontWeight:"semi-bold",textAlign:"center",color:"white",children:n===0?e.jsx(c,{color:u?"#ccc":"#F49040",cursor:u?"not-allowed":"pointer",onClick:()=>!u&&I(d),children:u?"Resending...":"Resend OTP"}):W(n)}),e.jsxs(N,{spacing:3,align:"stretch",children:[e.jsx(Y,{isRequired:!0}),e.jsx(O,{type:"submit",isLoading:A,loadingText:"Verifying",spinnerPlacement:"start",isDisabled:n===0||a||p,mb:{base:"2px",sm:"8px",md:"12px"},bg:"#F49040",color:"white",width:"full",borderRadius:"30px",h:{base:"34px",sm:"42px",md:"48px"},fontSize:{base:"14px",sm:"16px",md:"18px"},_hover:{border:"2px solid #F49040",color:"#F49040",bg:"none",boxShadow:"0px 2px 5px #F49040"},_focus:{outline:"none",boxShadow:"none"},children:"Verify"})]})]})]})})}export{te as default};
